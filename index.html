<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>National Operations Summary (NOSBeta)</title>
    <!-- Tailwind CSS CDN for easy styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Using Inter font for better readability and consistent design -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Force html and body to take full viewport height and prevent scrolling */
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden; /* This is the key for "no scroll" - content will be clipped if it genuinely doesn't fit */
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* Light gray background */
            line-height: 1.1; /* Very tight line height for compactness */
            display: flex; /* Use flex to ensure content fills vertically */
            flex-direction: column;
        }

        .menu-container {
            flex-grow: 1; /* Allows container to take up available vertical space */
            width: 100%; /* Full width of parent */
            max-width: 1600px; /* Increased max-width for very wide screens */
            margin: 0.25rem auto; /* Very small top/bottom margin */
            padding: 0.75rem; /* Reduced padding */
            background-color: #ffffff;
            border-radius: 0.5rem; /* Smaller border-radius */
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06); /* Lighter, subtle shadow */
            box-sizing: border-box; 
            display: flex; /* Use flex for internal layout of title, search, grid */
            flex-direction: column;
        }

        h1 {
            font-size: 1.8rem; /* Slightly smaller main title */
            margin-bottom: 0.8rem; /* Reduced margin */
        }

        .search-input {
            width: 100%;
            padding: 0.5rem 0.75rem; /* Reduced padding */
            border-radius: 0.5rem; /* Smaller border-radius */
            border: 1px solid #dcdfe6;
            margin-bottom: 1rem; /* Reduced margin */
            font-size: 0.95rem; /* Smaller font size */
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.04);
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }
        .search-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.1); 
        }

        .category-grid-wrapper {
            flex-grow: 1; /* Allows the grid area to expand and take available vertical space */
            overflow: hidden; /* Important for "no scroll" on the grid itself, if height calculation fails */
            box-sizing: border-box;
            display: flex; /* Ensure inner content pushes to max height */
            align-items: stretch; /* Stretch columns to fill height if needed */
        }

        .category-grid {
            display: grid;
            /* Explicitly define 5 columns */
            grid-template-columns: 1fr 1fr 1fr 1fr 1fr; /* 5 equal columns */
            /* Define 2 explicit rows to control stacking */
            grid-template-rows: min-content min-content; 
            gap: 0.6rem; /* Very tight gap */
            align-items: start; /* Align items to the start of their grid cell */
            width: 100%; /* Ensure grid takes full width of its wrapper */
            height: 100%; /* Important: try to fill the vertical space of the wrapper */
            /* Define named grid areas for precise placement */
            grid-template-areas: 
                "sit-summary weather logistics sads-dro financial-assist"
                ". . . risk-tool comm-adapt"; /* Empty cells to maintain 5 columns */
        }

        .category-card {
            background-color: #f7f9fc;
            border-radius: 0.4rem; /* Even smaller border-radius */
            padding: 0.6rem; /* Minimal padding */
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.03); /* Very light shadow */
            display: flex; 
            flex-direction: column;
            align-items: center;
            text-align: center;
            height: auto; /* Allow height to adjust to content */
            box-sizing: border-box;
        }

        /* Explicit grid placement for each category card using grid-area */
        .card-1-sit-summary { grid-area: sit-summary; }
        .card-2-weather { grid-area: weather; }
        .card-4-logistics { grid-area: logistics; }
        .card-6-sads-dro { grid-area: sads-dro; }
        .card-7-financial-assist { grid-area: financial-assist; }
        .card-8-risk-tool { grid-area: risk-tool; } /* Placed in second row, fourth column */
        .card-9-community-cap { grid-area: comm-adapt; } /* Placed in second row, fifth column */


        .category-title {
            font-size: 0.95rem; /* Small title font */
            font-weight: 600; /* Slightly lighter font weight for titles */
            color: #2c3e50;
            margin-bottom: 0.5rem; /* Reduced margin */
            padding-bottom: 0.2rem; /* Reduced padding */
            border-bottom: 1px solid #d0d0d0; /* Lighter border */
            width: 100%;
        }
        .category-subtitle { 
            font-size: 0.75rem; /* Smallest subtitle font */
            margin: 0.2rem 0 0.15rem; /* Minimal margins */
            font-weight: 500; 
        }
        .menu-button {
            display: block;
            width: 100%;
            padding: 0.3rem 0.5rem; /* Minimal button padding */
            margin-bottom: 0.25rem; /* Very tight margin */
            border-radius: 0.3rem; /* Smallest border-radius */
            font-weight: 500; 
            text-align: center;
            text-decoration: none;
            color: white; 
            transition: transform 0.1s ease, box-shadow 0.1s ease, background-color 0.1s ease;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.06); /* Very light shadow */
            font-size: 0.8rem; /* Very small button text */
        }
        .menu-button:hover {
            transform: translateY(-0.5px); /* Minimal lift */
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); 
        }

        /* Button Color Themes (unchanged, just applied to new sizes) */
        .btn-purple { background-color: #8e44ad; } 
        .btn-purple:hover { background-color: #9b59b6; }

        .btn-blue { background-color: #3498db; } 
        .btn-blue:hover { background-color: #2980b9; }

        .btn-green { background-color: #27ae60; } 
        .btn-green:hover { background-color: #2ecc71; }

        .btn-orange { background-color: #e67e22; } 
        .btn-orange:hover { background-color: #f39c12; }

        .btn-red { background-color: #e74c3c; } 
        .btn-red:hover { background-color: #c0392b; }

        .btn-black { background-color: #34495e; } 
        .btn-black:hover { background-color: #2c3e50; }

        .btn-red-dark { background-color: #7f1d1d; }
        .btn-red-dark:hover { background-color: #9b2a2a; }

        /* Search input specific styles */
        .search-input {
            width: 100%;
            padding: 0.6rem 1rem; 
            border-radius: 0.6rem; 
            border: 1px solid #dcdfe6;
            margin-bottom: 1.5rem; 
            font-size: 1rem; 
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.05);
        }
        .search-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.15); 
        }

        /* Responsive adjustments using explicit grid-template-areas for different column counts */
        @media (min-width: 1400px) {
            .category-grid {
                grid-template-columns: 1fr 1fr 1fr 1fr 1fr; /* 5 columns */
                grid-template-areas: 
                    "sit-summary weather logistics sads-dro financial-assist"
                    ". . . risk-tool comm-adapt"; 
            }
        }
        @media (min-width: 1100px) and (max-width: 1399px) {
            .category-grid {
                grid-template-columns: 1fr 1fr 1fr 1fr; /* 4 columns */
                grid-template-areas: 
                    "sit-summary weather logistics sads-dro"
                    "financial-assist . risk-tool comm-adapt"; /* Shift financial-assist to start of new row */
            }
        }
        @media (min-width: 850px) and (max-width: 1099px) {
            .category-grid {
                grid-template-columns: 1fr 1fr 1fr; /* 3 columns */
                grid-template-areas: 
                    "sit-summary weather logistics"
                    "sads-dro financial-assist risk-tool"
                    "comm-adapt . ."; /* New row for comm-adapt */
            }
        }
        @media (min-width: 600px) and (max-width: 849px) {
            .category-grid {
                grid-template-columns: 1fr 1fr; /* 2 columns */
                /* Revert to auto-placement for these smaller views as explicit placement becomes too complex to maintain strict vertical alignment */
                grid-template-areas: unset; /* Remove named areas */
                grid-auto-flow: row dense; /* Auto-place items */
            }
            .category-card { grid-area: auto !important; } /* Ensure no explicit grid area overrides */
        }
        @media (max-width: 599px) {
            .category-grid {
                grid-template-columns: 1fr; /* Single column */
                grid-template-areas: unset; /* Remove named areas */
                grid-auto-flow: row dense; /* Auto-place items */
            }
            .category-card { grid-area: auto !important; } /* Ensure no explicit grid area overrides */
        }
    </style>
</head>
<body>

    <div class="menu-container">
        <h1 class="text-center text-gray-800 font-bold mb-4">National Operations Summary</h1>

        <div class="mb-4">
            <input type="text" id="menuSearch" class="search-input" placeholder="Search menu items...">
        </div>

        <div class="category-grid-wrapper">
            <div id="menuContent" class="category-grid">
                <!-- Category: 1 Situation Summary (Purple) -->
                <div class="category-card card-1-sit-summary">
                    <h2 class="category-title">1 Situation Summary</h2>
                    <a href="#" class="menu-button btn-purple" data-search-term="National">National</a>
                    <a href="#" class="menu-button btn-purple" data-search-term="Heat Risk">Heat Risk</a>
                    <a href="#" class="menu-button btn-purple" data-search-term="FY23 Incidents and DROs">FY23 Incidents and DROs</a>
                    <a href="#" class="menu-button btn-purple" data-search-term="DCS 5YR Plan">DCS 5YR Plan</a>
                    <a href="#" class="menu-button btn-purple" data-search-term="DCS Narrative">DCS Narrative</a>
                    <a href="#" class="menu-button btn-purple" data-search-term="Global Trends">Global Trends</a>
                    <a href="#" class="menu-button btn-purple" data-search-term="DOCC Portal">DOCC Portal</a>
                    <a href="#" class="menu-button btn-purple" data-search-term="Current OPS Rep">Current OPS Rep</a>
                    <a href="#" class="menu-button btn-purple" data-search-term="Power Outages">Power Outages</a>
                </div>
                
                <!-- Category: 2 Weather (Blue) -->
                <div class="category-card card-2-weather">
                    <h2 class="category-title">2 Weather</h2>
                    <a href="#" class="menu-button btn-blue" data-search-term="Storm Prediction Ctr">Storm Prediction Ctr</a>
                    <a href="#" class="menu-button btn-blue" data-search-term="Precipitation">Precipitation</a>
                    <a href="#" class="menu-button btn-blue" data-search-term="Flood Prediction">Flood Prediction</a>
                    <a href="#" class="menu-button btn-blue" data-search-term="Natl Hurricane Ctr">Natl Hurricane Ctr</a>
                    <a href="#" class="menu-button btn-blue" data-search-term="7 Day Fire Risk">7 Day Fire Risk</a>
                    <a href="#" class="menu-button btn-blue" data-search-term="Hurricane">Hurricane</a>
                    <a href="#" class="menu-button btn-blue" data-search-term="California EMS">California EMS</a>
                    <a href="#" class="menu-button btn-blue" data-search-term="Natl Interagency Fire">Natl Interagency Fire</a>
                    <a href="#" class="menu-button btn-blue" data-search-term="Weather - General">Weather - General</a>
                    <a href="#" class="menu-button btn-blue" data-search-term="Tropical Hazards">Tropical Hazards</a>
                    <a href="#" class="menu-button btn-blue" data-search-term="Fire Weather">Fire Weather</a>
                    <h2 class="category-title">3 Sheltering</h2>
                    <a href="#" class="menu-button btn-blue" data-search-term="National Sheltering">National Sheltering</a>
                    <a href="#" class="menu-button btn-blue" data-search-term="Current Open">Current Open</a>
                    <a href="#" class="menu-button btn-blue" data-search-term="Shelter Intake">Shelter Intake</a>
                    <a href="#" class="menu-button btn-blue" data-search-term="SCIA Operational Dashboard">SCIA Operational Dashboard</a>
                    <a href="#" class="menu-button btn-blue" data-search-term="Restricted SCIA Access Request">Restricted SCIA Access Request</a>
                </div>
                
                <!-- Category: 4 Logistics (Green) -->
                <div class="category-card card-4-logistics">
                    <h2 class="category-title">4 Logistics</h2>
                    <a href="#" class="menu-button btn-green" data-search-term="Staffing">Staffing</a>
                    <a href="#" class="menu-button btn-green" data-search-term="Staff Capacity Building">Staff Capacity Building</a>
                    <a href="#" class="menu-button btn-green" data-search-term="EBV - Event Volunteers">EBV - Event Volunteers</a>
                    <a href="#" class="menu-button btn-green" data-search-term="DST - Disaster Serv Tech">DST - Disaster Serv Tech</a>
                    <a href="#" class="menu-button btn-green" data-search-term="IKD - In Kind Donations">IKD - In Kind Donations</a>
                    <a href="#" class="menu-button btn-green" data-search-term="Trailer & Assets">Trailer & Assets</a>
                    <a href="#" class="menu-button btn-green" data-search-term="ERV - Emergency Vehicles">ERV - Emergency Vehicles</a>
                    <a href="#" class="menu-button btn-green" data-search-term="Resourcing">Resourcing</a>
                    <a href="#" class="menu-button btn-green" data-search-term="Speed to Scale">Speed to Scale</a>
                    <h2 class="category-title">5 Call Center</h2>
                    <a href="#" class="menu-button btn-green" data-search-term="1 800 Red Cross">1 800 Red Cross</a>
                </div>

                <!-- Category: 6 SADS & DRO (Orange) -->
                <div class="category-card card-6-sads-dro">
                    <h2 class="category-title">6 SADS & DRO</h2>
                    <a href="#" class="menu-button btn-orange" data-search-term="DOCC Current OPS">DOCC Current OPS</a>
                    <a href="#" class="menu-button btn-orange" data-search-term="NIC Teams DRO Leadership">NIC Teams DRO Leadership</a>
                    <a href="#" class="menu-button btn-orange" data-search-term="Active DROs">Active DROs</a>
                    <a href="#" class="menu-button btn-orange" data-search-term="Natl Activation Levels">Natl Activation Levels</a>
                    <a href="#" class="menu-button btn-orange" data-search-term="DRO Call Agenda">DRO Call Agenda</a>
                    <a href="#" class="menu-button btn-orange" data-search-term="Dist Partner Hub">Dist Partner Hub</a>
                    <a href="#" class="menu-button btn-orange" data-search-term="Hurricane Advance Planning">Hurricane Advance Planning</a>
                    <a href="#" class="menu-button btn-orange" data-search-term="DR 503-25 South Texas">DR 503-25 South Texas</a>
                    <a href="#" class="menu-button btn-orange" data-search-term="DR 535-25 Missouri/Ark">DR 535-25 Missouri/Ark</a>
                    <a href="#" class="menu-button btn-orange" data-search-term="DR 539-25 Kentucky">DR 539-25 Kentucky</a>
                    <a href="#" class="menu-button btn-orange" data-search-term="DR 540-25 Tennessee">DR 540-25 Tennessee</a>
                    <a href="#" class="menu-button btn-orange" data-search-term="DR 548-25 Indiana">DR 548-25 Indiana</a>
                    <a href="#" class="menu-button btn-orange" data-search-term="DR 550-25 Illinois">DR 550-25 Illinois</a>
                    <a href="#" class="menu-button btn-orange" data-search-term="DR 515-25 Harney, Oregon">DR 515-25 Harney, Oregon</a>
                    <a href="#" class="menu-button btn-orange" data-search-term="DR 497-25 Oklahoma">DR 497-25 Oklahoma</a>
                    <a href="#" class="menu-button btn-orange" data-search-term="DRO Comp BETA Tool">DRO Comp BETA Tool</a>
                </div>

                <!-- Category: 7 Financial Assist DAT (Red) -->
                <div class="category-card card-7-financial-assist">
                    <h2 class="category-title">7 Financial Assist DAT</h2>
                    <a href="#" class="menu-button btn-red" data-search-term="Client Assistance">Client Assistance</a>
                    <a href="#" class="menu-button btn-red" data-search-term="Level 1-2 Casework FA">Level 1-2 Casework FA</a>
                    <a href="#" class="menu-button btn-red" data-search-term="IDC Financial">IDC Financial</a>
                    <a href="#" class="menu-button btn-red" data-search-term="Bridge">Bridge</a>
                    <a href="#" class="menu-button btn-red" data-search-term="DAT">DAT</a>
                    <a href="#" class="menu-button btn-red" data-search-term="Request Access">Request Access</a>
                    <a href="#" class="menu-button btn-red" data-search-term="Current Ops">Current Ops</a>
                    <a href="#" class="menu-button btn-red" data-search-term="Disaster Current OPs Dashboard">Disaster Current OPs Dashboard</a>
                    <a href="#" class="menu-button btn-red" data-search-term="Natl Operations - Client Assistance">Natl Operations - Client Assistance</a>
                    <a href="#" class="menu-button btn-red" data-search-term="Bridge Dashboard Historical Info">Bridge Dashboard Historical Info</a>
                </div>

                <!-- NEW: 8 Regional Risk Tool - PLACED EXACTLY BELOW 6 SADS & DRO -->
                <div class="category-card card-8-risk-tool">
                    <h2 class="category-title">8 Regional Risk Tool</h2>
                    <a href="#" class="menu-button btn-black" data-search-term="Regl Risk Tool">Regl Risk Tool</a>
                </div>

                <!-- NEW: 9 Community Adaptation CAP - PLACED EXACTLY BELOW 7 Financial Assist DAT -->
                <div class="category-card card-9-community-cap">
                    <h2 class="category-title">9 Community Adaptation CAP</h2>
                    <a href="#" class="menu-button btn-black" data-search-term="Community Adaptation">Community Adaptation</a>
                    <a href="#" class="menu-button btn-black" data-search-term="Housing Resources">Housing Resources</a>
                </div>
            </div>
        </div>

        <div class="text-center mt-3">
            <a href="#" class="menu-button btn-red-dark inline-block w-auto px-5 py-2 rounded-full text-base" data-search-term="Contact with any Questions">Contact with any Questions</a>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('menuSearch');
            const menuContent = document.getElementById('menuContent');
            const allCategoryCards = menuContent.querySelectorAll('.category-card'); 
            const allMenuButtons = menuContent.querySelectorAll('.menu-button'); 

            // Hardcoded page map from your config.json (simplified for relevant pages)
            // This object maps button text/data-search-term to page IDs and URLs from config.json
            const pageMap = {
                "National": {id: "page_84", url: "https://experience.arcgis.com/experience/84dbd2ab506d4fddb683ffd6c5501180"},
                "Heat Risk": {id: "page_95", url: "https://www.wpc.ncep.noaa.gov/heatrisk/"},
                "FY23 Incidents and DROs": {id: "page_96", url: "https://www.arcgis.com/apps/dashboards/21a7f226e058473e9be008505be61e26"}, 
                "DCS 5YR Plan": {id: "page_97", page_id: "page_97"}, // Use page_id for internal navigation
                "DCS Narrative": {id: "page_98", page_id: "page_98"},
                "Global Trends": {id: "page_99", page_id: "page_99"},
                "DOCC Portal": {id: "page_100", url: "https://apps.powerapps.com/play/e/0a52f298-38c2-4f5d-8c45-b3436caf8649/a/22598684-b075-4c5f-be99-1aba7948b791?tenantId=dd5b5d42-c0d3-4ad2-b5f1-60edb3af2771&hidenavbar=true"},
                "Current OPS Rep": {id: "page_101", url: "https://www.arcgis.com/apps/dashboards/84b1d8a1ff6b4f7c892b2f8da31b3657"},
                "Power Outages": {id: "page_102", url: "https://poweroutage.us/"}, 
                "Storm Prediction Ctr": {id: "page_104", url: "https://www.spc.noaa.gov"},
                "Precipitation": {id: "page_106", url: "https://www.wpc.ncep.noaa.gov/qpf/qpf2.shtml"},
                "Flood Prediction": {id: "page_107", url: "https://water.weather.gov/ahps/"},
                "Natl Hurricane Ctr": {id: "page_108", url: "https://www.nhc.noaa.gov/"},
                "7 Day Fire Risk": {id: "page_109", url: "https://fsapps.nwcg.gov/psp/npsg/forecast/#/outlooks?state=map"},
                "California EMS": {id: "page_111", url: "https://calprep-calema.hub.arcgis.com/"},
                "Natl Interagency Fire": {id: "page_112", url: "https://arc-nhq-gis.maps.arcgis.com/apps/MapSeries/index.html?appid=eef9de0158c440a896955c4fb2dc639c"}, 
                "Weather - General": {id: "page_173", url: "https://arc-nhq-gis.maps.arcgis.com/apps/MapSeries/index.html?appid=eef9de0158c440a896955c4fb2dc639c"}, 
                "Tropical Hazards": {id: "page_174", url: "https://arc-nhq-gis.maps.arcgis.com/apps/MapSeries/index.html?appid=b1449dc63d154cc9b13bcfe3b0d93cc9"}, 
                "Fire Weather": {id: "page_175", url: "https://www.nifc.gov/fire-information"}, 
                "National Sheltering": {id: "page_114", url: "https://arc-nhq-gis.maps.arcgis.com/apps/dashboards/0540322bacee4fa39e5b512bffc5f901"},
                "Current Open": {id: "page_122", url: "https://arc-nhq-gis.maps.arcgis.com/apps/dashboards/0540322bacee4fa39e5b512bffc5f901"}, 
                "Shelter Intake": {id: "page_123", url: "https://arc-nhq-gis.maps.arcgis.com/apps/dashboards/651c6d08e4874210ade0af696ba82f07"},
                "SCIA Operational Dashboard": {id: "page_176", url: "https://app.powerbi.com/reportEmbed?reportId=fa29be8f-7b6f-4090-b316-cf960419dd16&appId=6ae92fb9-56ad-4b06-b535-855949e47dec&autoAuth=true&ctid=dd5b5d42-c0d3-4ad2-b5f1-60edb3af2771"},
                "Restricted SCIA Access Request": {id: "page_177", url: "https://forms.office.com/pages/responsepage.aspx?id=Ql1b3dPA0kq18WDts68nccEZ0rG-i_FEnQ7UpIuUp3hUODVHV0c4V0NCQlRCQzlVVE5MQ0VURTdaViQlQCN0PWcu&route=shorturl"},
                "Staffing": {id: "page_116", url: "https://arc-nhq-gis.maps.arcgis.com/apps/dashboards/f25117c3cd2149ca9634801803ed5393"},
                "Staff Capacity Building": {id: "page_168", url: "https://arc-nhq-gis.maps.arcgis.com/apps/dashboards/158256c4c4b549d0b809632c6cdcf872"}, 
                "EBV - Event Volunteers": {id: "page_124", url: "https://app.powerbi.com/reportEmbed?reportId=0cd807f2-d988-4cf7-9425-f043cd70c981&appId=6ae92fb9-56ad-4b06-b535-855949e47dec&autoAuth=true&ctid=dd5b5d42-c0d3-4ad2-b5f1-60edb3af2771"},
                "DST - Disaster Serv Tech": {id: "page_125", url: "https://arc-nhq-gis.maps.arcgis.com/apps/dashboards/b1cd7d0b382c4fa3bacea57448102200"},
                "IKD - In Kind Donations": {id: "page_126", url: "https://arc-nhq-gis.maps.arcgis.com/apps/dashboards/45bc895fd18a4cafb0486d04d7e35f82"},
                "Trailer & Assets": {id: "page_127", url: "https://arc-nhq-gis.maps.arcgis.com/apps/dashboards/4cda594568144ba3ba5837afe3777646"},
                "ERV - Emergency Vehicles": {id: "page_128", url: "https://arc-nhq-gis.maps.arcgis.com/apps/dashboards/b70a992090c841d2be494e2dfd847646"},
                "Resourcing": {id: "page_150", url: "https://arc-nhq-gis.maps.arcgis.com/apps/dashboards/162311dcc7d645ea97b9a63afda6c80c"},
                "Speed to Scale": {id: "page_169", url: "https://arc-nhq-gis.maps.arcgis.com/apps/dashboards/158256c4c4b549d0b809632c6cdcf872"}, 
                "1 800 Red Cross": {id: "page_117", url: "https://arc-nhq-gis.maps.arcgis.com/apps/dashboards/ab58d70b8ae74e7da6c5f9ea9d6dd143"},
                "DOCC Current OPS": {id: "page_119", url: "https://arc-nhq-gis.maps.arcgis.com/apps/dashboards/84b1d8a1ff6b4f7c892b2f8da31b3657"},
                "NIC Teams DRO Leadership": {id: "page_132", url: "https://arc-nhq-gis.maps.arcgis.com/apps/dashboards/136120d9a7ef4d8195b21197e9847047"},
                "Active DROs": {id: "page_133", url: "https://arc-nhq-gis.maps.arcgis.com/apps/dashboards/6cbd1e41a9e7495c92cedcd834228043"},
                "Natl Activation Levels": {id: "page_134", url: "https://arc-nhq-gis.maps.arcgis.com/apps/MapSeries/index.html?appid=dd3d5bf14fac4f4fa47778075d996bdc"}, 
                "DRO Call Agenda": {id: "page_135", url: "https://intranet.redcross.org/content/dam/redcross/documents/our_services/DisasterCycleServices/dcs-management/disaster-cycle-service-operations/DROSyncCallAgenda.pdf"},
                "Dist Partner Hub": {id: "page_136", url: "https://www.disasterpartners.org/pages/home"},
                "Hurricane Advance Planning": {id: "page_170", url: "https://arc-nhq-gis.maps.arcgis.com/apps/instant/portfolio/index.html?appid=dd3d5bf14fac4f4fa47778075d996bdc"}, 
                "DR 503-25 South Texas": {id: "page_139", url: "https://arc-nhq-gis.maps.arcgis.com/apps/webappviewer/index.html?id=6edff10fb7184a2cbe9e34ffa29cf049"},
                "DR 535-25 Missouri/Ark": {id: "page_140", url: "https://arc-nhq-gis.maps.arcgis.com/apps/webappviewer/index.html?id=1a2ce887cdef4623a1a7f51691bfacc8"},
                "DR 539-25 Kentucky": {id: "page_141", url: "https://arc-nhq-gis.maps.arcgis.com/apps/webappviewer/index.html?id=aea55ad1cb2843da84de16ea62f49682"},
                "DR 540-25 Tennessee": {id: "page_155", url: "https://arc-nhq-gis.maps.arcgis.com/apps/webappviewer/index.html?id=aea55ad1cb2843da84de16ea62f49682"}, 
                "DR 548-25 Indiana": {id: "page_156", url: "https://arc-nhq-gis.maps.arcgis.com/apps/webappviewer/index.html?id=aea55ad1cb2843da84de16ea62f49682"}, 
                "DR 550-25 Illinois": {id: "page_157", url: "https://arc-nhq-gis.maps.arcgis.com/apps/webappviewer/index.html?id=359ecff2d08b4e46bfc7c33e3893c0ab"},
                "DR 515-25 Harney, Oregon": {id: "page_158", url: "https://arc-nhq-gis.maps.arcgis.com/apps/webappviewer/index.html?id=c05c1638c5a6457aa752c95dcbbb0913"},
                "DR 497-25 Oklahoma": {id: "page_159", url: "https://arc-nhq-gis.maps.arcgis.com/apps/webappviewer/index.html?id=dd2877d2555f4fcabc219a179f428432"},
                "DRO Comp BETA Tool": {id: "page_172", url: "https://experience.arcgis.com/experience/23ac6e42fdf64f41bb928fe24531ac45"}, 
                "Client Assistance": {id: "page_118", url: "https://app.powerbi.com/reportEmbed?reportId=144a7b38-21b1-42b1-b759-307956421e28&autoAuth=true&ctid=dd5b5d42-c0d3-4ad2-b5f1-60edb3af2771"},
                "Level 1-2 Casework FA": {id: "page_163", url: "https://app.powerbi.com/reportEmbed?reportId=bc5748b1-7087-435f-a898-de4819745f89&appId=8d4ab11d-bfcf-4724-8879-11782d14ba1c&autoAuth=true&ctid=dd5b5d42-c0d3-4ad2-b5f1-60edb3af2771"},
                "IDC Financial": {id: "page_142", url: "https://app.powerbi.com/reportEmbed?reportId=535766e8-58f8-4a99-81e2-d4ba956f1c9e&autoAuth=true&ctid=dd5b5d42-c0d3-4ad2-b5f1-60edb3af2771"},
                "Bridge": {id: "page_162", url: "https://app.powerbi.com/reportEmbed?reportId=51e0a811-4037-4744-88cd-b9355811094a&autoAuth=true&ctid=dd5b5d42-c0d3-4ad2-b5f1-60edb3af2771"}, 
                "DAT": {id: "page_171", url: "https://app.powerbi.com/reportEmbed?reportId=7b80587c-3bac-4bef-8dfb-225bd9e619b4&appId=8d4ab11d-bfcf-4724-8879-11782d14ba1c&autoAuth=true&ctid=dd5b5d42-c0d3-4ad2-b5f1-60edb3af2771"}, 
                "Request Access": {id: "page_164", url: "https://forms.office.com/Pages/ResponsePage.aspx?id=Ql1b3dPA0kq18WDts68nccEZ0rG-i_FEnQ7UpIuUp3hUMFZLTEpEWFJQMFJXUUtaUVBDUk1ENEpESyQlQCN0PWcu"},
                "Disaster Current OPs Dashboard": {id: "page_165", url: "https://app.powerbi.com/groups/me/apps/6ae92fb9-56ad-4b06-b535-855949e47dec/reports/3d94cfa9-91ac-4a68-af83-6be93371f344/ReportSection?experience=power-bi"},
                "Natl Operations - Client Assistance": {id: "page_166", url: "https://app.powerbi.com/groups/me/apps/6ae92fb9-56ad-4b06-b535-855949e47dec/reports/3d94cfa9-91ac-4a68-af83-6be93371f344/ReportSection?experience=power-bi"}, 
                "Bridge Dashboard Historical Info": {id: "page_167", url: "https://arc-nhq-gis.maps.arcgis.com/apps/instant/portfolio/index.html?appid=bbd835c463af4a53bd7c1a328c6018ad"},
                "Regl Risk Tool": {id: "page_120", url: "https://arc-nhq-gis.maps.arcgis.com/apps/MapSeries/index.html?appid=ba9341e8cb7847d885fd6843a4a7ca3e"},
                "Community Adaptation": {id: "page_121", url: "https://community-adaptation-program-arc-nhq-gis.hub.arcgis.com"},
                "Housing Resources": {id: "page_149", url: "https://americanredcross.sharepoint.com/sites/HousingResourceInfo"}, 
                "Contact with any Questions": {id: "contact_page", url: "https://forms.office.com/Pages/ResponsePage.aspx?id=Ql1b3dPA0kq18WDts68nccEZ0rG-i_FEnQ7UpIuUp3hUMFZLTEpEWFJQMFJXUUtaUVBDUk1ENEpESyQlQCN0PWcu"} 
            };

            // Main app ID from config.json (used for constructing internal page links)
            const APP_ID = "2ab560cd143d4e3292020ab22644be21";
            const BASE_EXPERIENCE_URL = "https://experience.arcgis.com/experience/" + APP_ID + "/page/"; // Base URL for internal Experience Builder pages

            function filterMenu() {
                const searchTerm = searchInput.value.toLowerCase();

                allCategoryCards.forEach(card => {
                    let hasVisibleContent = false; 
                    const titles = card.querySelectorAll('h2'); 
                    const buttonsInCard = card.querySelectorAll('.menu-button');

                    titles.forEach(title => {
                        if (title.textContent.toLowerCase().includes(searchTerm)) {
                            hasVisibleContent = true;
                        }
                    });
                    
                    buttonsInCard.forEach(button => {
                        const buttonText = button.textContent.toLowerCase();
                        const dataSearchTerm = button.dataset.searchTerm ? button.dataset.searchTerm.toLowerCase() : '';

                        if (buttonText.includes(searchTerm) || dataSearchTerm.includes(searchTerm)) {
                            button.style.display = 'block'; 
                            hasVisibleContent = true;
                        } else {
                            button.style.display = 'none'; 
                        }
                    });

                    if (searchTerm !== '' && !hasVisibleContent) {
                        card.style.display = 'none';
                    } else {
                        card.style.display = 'flex'; 
                    }
                });
            }

            function applyLinks() {
                allMenuButtons.forEach(button => {
                    const buttonText = button.textContent.trim();
                    const dataSearchTerm = button.dataset.searchTerm; 

                    let matchingPage = null;

                    if (dataSearchTerm && pageMap[dataSearchTerm]) {
                        matchingPage = pageMap[dataSearchTerm];
                    } 
                    else if (pageMap[buttonText]) {
                        matchingPage = pageMap[buttonText];
                    }

                    if (matchingPage) {
                        let targetUrl = matchingPage.url;
                        let targetPageId = matchingPage.id; // Get page ID if available

                        // Determine if it's an internal Experience Builder page or an external one
                        // A link is considered internal if it has a page_id or starts with specific ArcGIS domains.
                        const isInternalExperienceBuilderPage = (targetPageId !== undefined) || 
                                                               (targetUrl && (
                                                                  targetUrl.startsWith("https://experience.arcgis.com/experience/") || 
                                                                  targetUrl.startsWith("https://arc-nhq-gis.maps.arcgis.com/") ||
                                                                  targetUrl.startsWith("https://apps.powerapps.com/") || 
                                                                  targetUrl.startsWith("https://app.powerbi.com/")
                                                               ));
                        
                        // Set the href for accessibility (right-click, copy link address)
                        // For internal pages, set it to the hash URL for consistent browser history behavior
                        if (targetPageId && isInternalExperienceBuilderPage) {
                            button.href = `#page/${targetPageId}`;
                        } else {
                            button.href = targetUrl;
                        }

                        // Attach the click listener
                        button.addEventListener('click', function(e) {
                            e.preventDefault(); // Always prevent default anchor link navigation when handled by JS

                            if (isInternalExperienceBuilderPage) {
                                // For internal Experience Builder pages, force top-level navigation
                                // This is the most reliable method for published EB apps
                                const fullInternalUrl = `${window.top.location.origin}${window.top.location.pathname}#page/${targetPageId}`;
                                console.log("Attempting top-level internal EB navigation:", fullInternalUrl);
                                try {
                                    window.top.location.href = fullInternalUrl;
                                } catch (error) {
                                    console.error("Error attempting top-level navigation:", error);
                                    // Fallback if window.top.location.href is also blocked (unlikely but possible in extreme cases)
                                    // Try postMessage as a final fallback, though less reliable if basic hash change fails
                                    if (window.parent) {
                                        console.warn("Top-level navigation blocked. Trying postMessage as fallback.");
                                        window.parent.postMessage({ 
                                            type: 'page-navigation', 
                                            pageId: targetPageId, 
                                            hash: `#page/${targetPageId}` 
                                        }, '*');
                                    } else {
                                        console.warn("Neither top-level navigation nor postMessage available. Link may not work.");
                                    }
                                }
                            } else {
                                // For truly external links, open in a new tab
                                console.log("Opening external link in new tab:", targetUrl);
                                window.open(targetUrl, '_blank');
                            }
                        });
                    } else {
                        console.warn("No matching page found in pageMap for button:", buttonText);
                        button.href = "#"; // Keep placeholder if no link found
                        // Optionally disable button or indicate it's not clickable
                        // button.style.pointerEvents = 'none'; 
                    }
                });
            }

            // Call applyLinks after DOM is loaded
            applyLinks();
            
            // Event listeners for search input
            searchInput.addEventListener('keyup', filterMenu);
            searchInput.addEventListener('change', filterMenu); 
        });
    </script>
</body>
</html>
